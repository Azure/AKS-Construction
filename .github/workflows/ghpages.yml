name: Validate GitHub Pages site

on:
  ## Pre-PR approval, Status checks that are required (needs to have job called 'Validation'), or PR will not merge
  pull_request:
    # Target branch (any source branch)
    branches: [main]
    paths:
      - ".github/workflows/ghpages.yml"
      - "helper/**"

  workflow_dispatch:
    inputs:
      doAzCmdDeployment:
        description: 'Test AZ Cmd by deploying to an Azure subscription'
        default: false
        type: boolean
        required: false

jobs:
  Validation:
    uses: ./.github/workflows/ghpagesTest.yml
    with:
      REACT_APP_TEMPLATERELEASE: "" #Null value means to just test on main branch (local) not a release tag
    secrets:
      AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}

  Spelling:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: streetsidesoftware/cspell-action@v1.3.4
        name: Spell Check
        if: ${{github.event_name!='workflow_dispatch'}}
        with:
          config: './cspell.json'
          inline: warning
          root: '.'
          files: "**/*.{ts,js,md}" #You need to respecify this setting - even though it's in the cspell.json config :(
          incremental_files_only: false
          strict: true #setting to false allows the build to continue even if spelling mistakes are detected
