{"version":3,"file":"PositioningContainer.js","sourceRoot":"../src/","sources":["components/Coachmark/PositioningContainer/PositioningContainer.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { getClassNames } from './PositioningContainer.styles';\nimport { ZIndexes } from '../../../Styling';\nimport { Layer } from '../../../Layer';\n\n// Utilites/Helpers\nimport { DirectionalHint } from '../../../common/DirectionalHint';\nimport { css, elementContains, focusFirstChild, EventGroup, getPropsWithDefaults } from '../../../Utilities';\n\nimport { getMaxHeight, positionElement, RectangleEdge } from '../../../Positioning';\n\nimport { AnimationClassNames, mergeStyles } from '../../../Styling';\nimport { useMergedRefs, useAsync, useTarget } from '@fluentui/react-hooks';\nimport type { IPositioningContainerProps } from './PositioningContainer.types';\nimport type { Point, IRectangle } from '../../../Utilities';\nimport type { IPositionedData, IPositionProps, IPosition } from '../../../Positioning';\n\nconst OFF_SCREEN_STYLE = { opacity: 0 };\n\n// In order for some of the max height logic to work properly we need to set the border.\n// The value is arbitrary.\nconst BORDER_WIDTH = 1;\nconst SLIDE_ANIMATIONS = {\n  [RectangleEdge.top]: 'slideUpIn20',\n  [RectangleEdge.bottom]: 'slideDownIn20',\n  [RectangleEdge.left]: 'slideLeftIn20',\n  [RectangleEdge.right]: 'slideRightIn20',\n} as const;\n\nconst DEFAULT_PROPS = {\n  preventDismissOnScroll: false,\n  offsetFromTarget: 0,\n  minPagePadding: 8,\n  directionalHint: DirectionalHint.bottomAutoEdge,\n};\n\nfunction useCachedBounds(props: IPositioningContainerProps, targetWindow: Window | undefined) {\n  /** The bounds used when determining if and where the PositioningContainer should be placed. */\n  const positioningBounds = React.useRef<IRectangle>();\n\n  const getCachedBounds = (): IRectangle => {\n    if (!positioningBounds.current) {\n      let currentBounds = props.bounds;\n\n      if (!currentBounds) {\n        currentBounds = {\n          top: 0 + props.minPagePadding!,\n          left: 0 + props.minPagePadding!,\n          right: targetWindow!.innerWidth - props.minPagePadding!,\n          bottom: targetWindow!.innerHeight - props.minPagePadding!,\n          width: targetWindow!.innerWidth - props.minPagePadding! * 2,\n          height: targetWindow!.innerHeight - props.minPagePadding! * 2,\n        };\n      }\n      positioningBounds.current = currentBounds;\n    }\n    return positioningBounds.current;\n  };\n\n  return getCachedBounds;\n}\n\nfunction usePositionState(\n  props: IPositioningContainerProps,\n  positionedHost: React.RefObject<HTMLDivElement | null>,\n  contentHost: React.RefObject<HTMLDivElement | null>,\n  targetRef: React.RefObject<Element | MouseEvent | Point | null>,\n  getCachedBounds: () => IRectangle,\n) {\n  const async = useAsync();\n  /**\n   * Current set of calculated positions for the outermost parent container.\n   */\n  const [positions, setPositions] = React.useState<IPositionedData>();\n  const positionAttempts = React.useRef(0);\n\n  const updateAsyncPosition = (): void => {\n    async.requestAnimationFrame(() => updatePosition());\n  };\n\n  const updatePosition = (): void => {\n    const { offsetFromTarget, onPositioned } = props;\n    const hostElement = positionedHost.current;\n    const positioningContainerElement = contentHost.current;\n\n    if (hostElement && positioningContainerElement) {\n      const currentProps: IPositionProps = { ...props } as IPositionProps;\n      currentProps!.bounds = getCachedBounds();\n      currentProps!.target = targetRef.current!;\n      const { target } = currentProps;\n\n      if (target) {\n        // Check if the target is an Element or a MouseEvent and the document contains it\n        // or don't check anything else if the target is a Point or Rectangle\n        if (\n          (!(target as Element).getBoundingClientRect && !(target as MouseEvent).preventDefault) ||\n          document.body.contains(target as Node)\n        ) {\n          currentProps!.gapSpace = offsetFromTarget;\n          const newPositions: IPositionedData = positionElement(\n            currentProps!,\n            hostElement,\n            positioningContainerElement,\n          );\n          // Set the new position only when the positions are not exists or one of the new positioningContainer\n          // positions are different. The position should not change if the position is within 2 decimal places.\n          if (\n            (!positions && newPositions) ||\n            (positions && newPositions && !arePositionsEqual(positions, newPositions) && positionAttempts.current < 5)\n          ) {\n            // We should not reposition the positioningContainer more than a few times, if it is then the content is\n            // likely resizing and we should stop trying to reposition to prevent a stack overflow.\n            positionAttempts.current++;\n            setPositions(newPositions);\n            onPositioned?.(newPositions);\n          } else {\n            positionAttempts.current = 0;\n            onPositioned?.(newPositions);\n          }\n        } else if (positions !== undefined) {\n          setPositions(undefined);\n        }\n      } else if (positions !== undefined) {\n        setPositions(undefined);\n      }\n    }\n  };\n\n  React.useEffect(updateAsyncPosition);\n\n  return [positions, updateAsyncPosition] as const;\n}\n\nfunction useSetInitialFocus(\n  { setInitialFocus }: IPositioningContainerProps,\n  contentHost: React.RefObject<HTMLDivElement | null>,\n  positions: IPositionedData | undefined,\n) {\n  const didSetInitialFocus = React.useRef(false);\n\n  React.useEffect((): void => {\n    if (!didSetInitialFocus.current && contentHost.current && setInitialFocus && positions) {\n      didSetInitialFocus.current = true;\n      focusFirstChild(contentHost.current);\n    }\n  });\n}\n\nfunction useMaxHeight(\n  { directionalHintFixed, offsetFromTarget, directionalHint, target }: IPositioningContainerProps,\n  targetRef: React.RefObject<Element | MouseEvent | Point | null>,\n  getCachedBounds: () => IRectangle,\n) {\n  /**\n   * The maximum height the PositioningContainer can grow to\n   * without going beyond the window or target bounds\n   */\n  const maxHeight = React.useRef<number | undefined>();\n\n  // If the target element changed, reset the max height. If we are tracking\n  // target with class name, always reset because we do not know if\n  // fabric has rendered a new element and disposed the old element.\n  if (typeof target === 'string') {\n    maxHeight.current = undefined;\n  }\n  React.useEffect(() => {\n    maxHeight.current = undefined;\n  }, [target, offsetFromTarget]);\n\n  /**\n   * Return the maximum height the container can grow to\n   * without going out of the specified bounds\n   */\n  const getCachedMaxHeight = (): number => {\n    if (!maxHeight.current) {\n      if (directionalHintFixed && targetRef.current) {\n        const gapSpace = offsetFromTarget ? offsetFromTarget : 0;\n        maxHeight.current = getMaxHeight(targetRef.current, directionalHint!, gapSpace, getCachedBounds());\n      } else {\n        maxHeight.current = getCachedBounds().height! - BORDER_WIDTH * 2;\n      }\n    }\n    return maxHeight.current!;\n  };\n\n  return getCachedMaxHeight;\n}\n\nfunction useAutoDismissEvents(\n  { onDismiss, preventDismissOnScroll }: IPositioningContainerProps,\n  positionedHost: React.RefObject<HTMLDivElement | null>,\n  targetWindow: Window | undefined,\n  targetRef: React.RefObject<Element | MouseEvent | Point | null>,\n  positions: IPositionedData | undefined,\n  updateAsyncPosition: () => void,\n) {\n  const async = useAsync();\n\n  const onResize = React.useCallback(\n    (ev?: Event | React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>): void => {\n      if (onDismiss) {\n        onDismiss(ev);\n      } else {\n        updateAsyncPosition();\n      }\n    },\n    [onDismiss, updateAsyncPosition],\n  );\n\n  const dismissOnLostFocus = React.useCallback(\n    (ev: Event): void => {\n      const target = ev.target as HTMLElement;\n      const clickedOutsideCallout = positionedHost.current && !elementContains(positionedHost.current, target);\n\n      if (\n        (!targetRef.current && clickedOutsideCallout) ||\n        (ev.target !== targetWindow &&\n          clickedOutsideCallout &&\n          ((targetRef.current as MouseEvent).stopPropagation ||\n            !targetRef.current ||\n            (target !== targetRef.current && !elementContains(targetRef.current as HTMLElement, target))))\n      ) {\n        onResize(ev);\n      }\n    },\n    [onResize, positionedHost, targetRef, targetWindow],\n  );\n\n  const dismissOnScroll = React.useCallback(\n    (ev: Event): void => {\n      if (positions && !preventDismissOnScroll) {\n        dismissOnLostFocus(ev);\n      }\n    },\n    [dismissOnLostFocus, positions, preventDismissOnScroll],\n  );\n\n  React.useEffect(() => {\n    const events = new EventGroup({});\n    // This is added so the positioningContainer will dismiss when the window is scrolled\n    // but not when something inside the positioningContainer is scrolled. The delay seems\n    // to be required to avoid React firing an async focus event in IE from\n    // the target changing focus quickly prior to rendering the positioningContainer.\n    async.setTimeout(() => {\n      events.on(targetWindow, 'scroll', async.throttle(dismissOnScroll, 10), true);\n      events.on(targetWindow, 'resize', async.throttle(onResize, 10), true);\n      events.on(targetWindow?.document?.body, 'focus', dismissOnLostFocus, true);\n      events.on(targetWindow?.document?.body, 'click', dismissOnLostFocus, true);\n    }, 0);\n\n    return () => events.dispose();\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- should only run on mount\n  }, [dismissOnScroll]);\n}\n\nexport function useHeightOffset(\n  { finalHeight }: IPositioningContainerProps,\n  contentHost: React.RefObject<HTMLDivElement | null>,\n) {\n  /**\n   * Tracks the current height offset and updates during\n   * the height animation when props.finalHeight is specified.\n   * State stored as object to ensure re-render even if the value does not change.\n   *  See https://github.com/microsoft/fluentui/issues/23545\n   */\n  const [heightOffset, setHeightOffset] = React.useState<{ value: number }>({ value: 0 });\n  const async = useAsync();\n  const setHeightOffsetTimer = React.useRef<number>(0);\n\n  /** Animates the height if finalHeight was given. */\n  const setHeightOffsetEveryFrame = (): void => {\n    if (contentHost && finalHeight) {\n      setHeightOffsetTimer.current = async.requestAnimationFrame(() => {\n        if (!contentHost.current) {\n          return;\n        }\n\n        const positioningContainerMainElem = contentHost.current.lastChild as HTMLElement;\n        const cardScrollHeight: number = positioningContainerMainElem.scrollHeight;\n        const cardCurrHeight: number = positioningContainerMainElem.offsetHeight;\n        const scrollDiff: number = cardScrollHeight - cardCurrHeight;\n\n        setHeightOffset({ value: heightOffset.value + scrollDiff });\n\n        if (positioningContainerMainElem.offsetHeight < finalHeight) {\n          setHeightOffsetEveryFrame();\n        } else {\n          async.cancelAnimationFrame(setHeightOffsetTimer.current);\n        }\n      });\n    }\n  };\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps -- should only re-run if finalHeight changes\n  React.useEffect(setHeightOffsetEveryFrame, [finalHeight]);\n\n  return heightOffset.value;\n}\n\nexport const PositioningContainer: React.FunctionComponent<IPositioningContainerProps> = React.forwardRef<\n  HTMLDivElement,\n  IPositioningContainerProps\n>((propsWithoutDefaults, forwardedRef) => {\n  const props = getPropsWithDefaults<IPositioningContainerProps>(DEFAULT_PROPS, propsWithoutDefaults);\n\n  // @TODO rename to reflect the name of this class\n  const contentHost = React.useRef<HTMLDivElement>(null);\n  /**\n   * The primary positioned div.\n   */\n  const positionedHost = React.useRef<HTMLDivElement>(null);\n  const rootRef = useMergedRefs(forwardedRef, positionedHost);\n\n  const [targetRef, targetWindow] = useTarget(props.target, positionedHost);\n  const getCachedBounds = useCachedBounds(props, targetWindow);\n  const [positions, updateAsyncPosition] = usePositionState(\n    props,\n    positionedHost,\n    contentHost,\n    targetRef,\n    getCachedBounds,\n  );\n  const getCachedMaxHeight = useMaxHeight(props, targetRef, getCachedBounds);\n  const heightOffset = useHeightOffset(props, contentHost);\n\n  useSetInitialFocus(props, contentHost, positions);\n  useAutoDismissEvents(props, positionedHost, targetWindow, targetRef, positions, updateAsyncPosition);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps -- should only run on initial render\n  React.useEffect(() => props.onLayerMounted?.(), []);\n\n  // If there is no target window then we are likely in server side rendering and we should not render anything.\n  if (!targetWindow) {\n    return null;\n  }\n\n  const { className, doNotLayer, positioningContainerWidth, positioningContainerMaxHeight, children } = props;\n\n  const styles = getClassNames();\n\n  const directionalClassName =\n    positions && positions.targetEdge ? AnimationClassNames[SLIDE_ANIMATIONS[positions.targetEdge]] : '';\n\n  const getContentMaxHeight: number = getCachedMaxHeight() + heightOffset!;\n  const contentMaxHeight: number =\n    positioningContainerMaxHeight! && positioningContainerMaxHeight! > getContentMaxHeight\n      ? getContentMaxHeight\n      : positioningContainerMaxHeight!;\n  const content = (\n    <div ref={rootRef} className={css('ms-PositioningContainer', styles.container)}>\n      <div\n        className={mergeStyles(\n          'ms-PositioningContainer-layerHost',\n          styles.root,\n          className,\n          directionalClassName,\n          !!positioningContainerWidth && { width: positioningContainerWidth },\n          doNotLayer && { zIndex: ZIndexes.Layer },\n        )}\n        style={positions ? positions.elementPosition : OFF_SCREEN_STYLE}\n        // Safari and Firefox on Mac OS requires this to back-stop click events so focus remains in the Callout.\n        // See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n        tabIndex={-1}\n        ref={contentHost}\n      >\n        {children}\n        {\n          // @TODO apply to the content container\n          contentMaxHeight\n        }\n      </div>\n    </div>\n  );\n\n  return doNotLayer ? content : <Layer {...props.layerProps}>{content}</Layer>;\n});\nPositioningContainer.displayName = 'PositioningContainer';\n\nfunction arePositionsEqual(positions: IPositionedData, newPosition: IPositionedData): boolean {\n  return comparePositions(positions.elementPosition, newPosition.elementPosition);\n}\n\nfunction comparePositions(oldPositions: IPosition, newPositions: IPosition): boolean {\n  for (const key in newPositions) {\n    if (newPositions.hasOwnProperty(key)) {\n      const oldPositionEdge = oldPositions[key];\n      const newPositionEdge = newPositions[key];\n\n      if (oldPositionEdge && newPositionEdge) {\n        if (oldPositionEdge.toFixed(2) !== newPositionEdge.toFixed(2)) {\n          return false;\n        }\n      }\n    }\n  }\n  return true;\n}\n"]}