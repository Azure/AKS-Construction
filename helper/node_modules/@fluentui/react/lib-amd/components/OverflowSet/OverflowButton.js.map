{"version":3,"file":"OverflowButton.js","sourceRoot":"../src/","sources":["components/OverflowSet/OverflowButton.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { KeytipManager } from '../../utilities/keytips/KeytipManager';\nimport { useConst, usePrevious } from '@fluentui/react-hooks';\nimport type { IKeytipProps } from '../../Keytip';\nimport type { IOverflowSetItemProps, IOverflowSetProps } from './OverflowSet.types';\n\nconst registerPersistedKeytips = (\n  keytipsToRegister: IKeytipProps[],\n  keytipManager: KeytipManager,\n  registeredPersistedKeytips: { [uniqueID: string]: IKeytipProps },\n) => {\n  for (const keytip of keytipsToRegister) {\n    const uniqueID = keytipManager.register(keytip, true);\n    // Update map\n    registeredPersistedKeytips[uniqueID] = keytip;\n  }\n};\n\nconst unregisterPersistedKeytips = (\n  keytipManager: KeytipManager,\n  registeredPersistedKeytips: { [uniqueID: string]: IKeytipProps },\n) => {\n  for (const uniqueID of Object.keys(registeredPersistedKeytips)) {\n    keytipManager.unregister(registeredPersistedKeytips[uniqueID], uniqueID, true);\n    delete registeredPersistedKeytips[uniqueID];\n  }\n};\n\nconst useKeytipRegistrations = (\n  registeredPersistedKeytips: { [uniqueID: string]: IKeytipProps },\n  keytipsToRegister: IKeytipProps[],\n  keytipManager: KeytipManager,\n) => {\n  const prevPersistedKeytips = usePrevious(registeredPersistedKeytips);\n\n  // Update\n  React.useEffect(() => {\n    if (prevPersistedKeytips) {\n      // Unregister old keytips\n      unregisterPersistedKeytips(keytipManager, prevPersistedKeytips);\n      // Register new keytips\n      registerPersistedKeytips(keytipsToRegister, keytipManager, registeredPersistedKeytips);\n    }\n  });\n\n  // Mount/Unmount\n  React.useEffect(() => {\n    // Register on mount\n    registerPersistedKeytips(keytipsToRegister, keytipManager, registeredPersistedKeytips);\n    return () => {\n      // Unregister on unmount\n      unregisterPersistedKeytips(keytipManager, registeredPersistedKeytips);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n\nexport const OverflowButton = (props: IOverflowSetProps) => {\n  const keytipManager: KeytipManager = KeytipManager.getInstance();\n  const { className, overflowItems, keytipSequences, itemSubMenuProvider, onRenderOverflowButton } = props;\n\n  const persistedKeytips = useConst<{ [uniqueID: string]: IKeytipProps }>({});\n\n  // Gets the subMenu for an overflow item\n  const getSubMenuForItem = React.useCallback(\n    (item: IOverflowSetItemProps) => {\n      // Checks if itemSubMenuProvider has been defined, if not defaults to subMenuProps\n      if (itemSubMenuProvider) {\n        return itemSubMenuProvider(item);\n      }\n      if (item.subMenuProps) {\n        return item.subMenuProps.items;\n      }\n      return undefined;\n    },\n    [itemSubMenuProvider],\n  );\n\n  const { modifiedOverflowItems, keytipsToRegister } = React.useMemo(() => {\n    const newKeytipsToRegister: IKeytipProps[] = [];\n    let newOverflowItems: IOverflowSetItemProps[] | undefined = [];\n\n    if (keytipSequences) {\n      overflowItems?.forEach(overflowItem => {\n        const keytip = (overflowItem as IOverflowSetItemProps).keytipProps;\n\n        if (keytip) {\n          // Create persisted keytip\n          const persistedKeytip: IKeytipProps = {\n            content: keytip.content,\n            keySequences: keytip.keySequences,\n            disabled: keytip.disabled || !!(overflowItem.disabled || overflowItem.isDisabled),\n            hasDynamicChildren: keytip.hasDynamicChildren,\n            hasMenu: keytip.hasMenu,\n          };\n\n          if (keytip.hasDynamicChildren || getSubMenuForItem(overflowItem)) {\n            // If the keytip has a submenu or children nodes, change onExecute to persistedKeytipExecute\n            persistedKeytip.onExecute = keytipManager.menuExecute.bind(\n              keytipManager,\n              keytipSequences,\n              overflowItem?.keytipProps?.keySequences,\n            );\n            persistedKeytip.hasOverflowSubMenu = true;\n          } else {\n            // If the keytip doesn't have a submenu, just execute the original function\n            persistedKeytip.onExecute = keytip.onExecute;\n          }\n\n          newKeytipsToRegister.push(persistedKeytip);\n\n          // Add the overflow sequence to this item\n          const newOverflowItem = {\n            ...overflowItem,\n            keytipProps: {\n              ...keytip,\n              overflowSetSequence: keytipSequences,\n            },\n          };\n          newOverflowItems?.push(newOverflowItem);\n        } else {\n          // Nothing to change, add overflowItem to list\n          newOverflowItems?.push(overflowItem);\n        }\n      });\n    } else {\n      newOverflowItems = overflowItems;\n    }\n    return { modifiedOverflowItems: newOverflowItems, keytipsToRegister: newKeytipsToRegister };\n  }, [overflowItems, getSubMenuForItem, keytipManager, keytipSequences]);\n\n  useKeytipRegistrations(persistedKeytips, keytipsToRegister, keytipManager);\n\n  return <div className={className}>{onRenderOverflowButton(modifiedOverflowItems)}</div>;\n};\n"]}