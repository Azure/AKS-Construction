{"version":3,"file":"SearchBox.base.js","sourceRoot":"../src/","sources":["components/SearchBox/SearchBox.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { KeyCodes, classNamesFunction, getNativeProps, inputProperties } from '../../Utilities';\nimport { useControllableValue, useId, useMergedRefs, useWarnings } from '@fluentui/react-hooks';\nimport { IconButton } from '../../Button';\nimport { Icon } from '../../Icon';\nimport type { ISearchBoxProps, ISearchBoxStyleProps, ISearchBoxStyles, ISearchBox } from './SearchBox.types';\nimport type { IButtonProps, IButtonStyles } from '../../Button';\nimport type { IIconProps } from '../../Icon';\n\nconst COMPONENT_NAME = 'SearchBox';\nconst iconButtonStyles: Partial<IButtonStyles> = { root: { height: 'auto' }, icon: { fontSize: '12px' } };\nconst iconButtonProps: IIconProps = { iconName: 'Clear' };\nconst defaultClearButtonProps: IButtonProps = { ariaLabel: 'Clear text' };\n\nconst getClassNames = classNamesFunction<ISearchBoxStyleProps, ISearchBoxStyles>();\n\nconst useComponentRef = (\n  componentRef: React.Ref<ISearchBox> | undefined,\n  inputElementRef: React.RefObject<HTMLInputElement>,\n  hasFocus: boolean,\n) => {\n  React.useImperativeHandle(\n    componentRef,\n    () => ({\n      focus: () => inputElementRef.current?.focus(),\n      hasFocus: () => hasFocus,\n    }),\n    [inputElementRef, hasFocus],\n  );\n};\n\nexport const SearchBoxBase: React.FunctionComponent<ISearchBoxProps> = React.forwardRef<\n  HTMLDivElement,\n  ISearchBoxProps\n>((props, forwardedRef) => {\n  const {\n    ariaLabel,\n    className,\n    defaultValue = '',\n    disabled,\n    underlined,\n    styles,\n    // eslint-disable-next-line deprecation/deprecation\n    labelText,\n    // eslint-disable-next-line deprecation/deprecation\n    placeholder = labelText,\n    theme,\n    clearButtonProps = defaultClearButtonProps,\n    disableAnimation = false,\n    showIcon = false,\n    onClear: customOnClear,\n    onBlur: customOnBlur,\n    onEscape: customOnEscape,\n    onSearch: customOnSearch,\n    onKeyDown: customOnKeyDown,\n    iconProps,\n    role,\n    onChange,\n    // eslint-disable-next-line deprecation/deprecation\n    onChanged,\n  } = props;\n\n  const [hasFocus, setHasFocus] = React.useState(false);\n\n  const prevChangeTimestamp = React.useRef<number | undefined>();\n  const [uncastValue, setValue] = useControllableValue(\n    props.value,\n    defaultValue,\n    (ev: React.ChangeEvent<HTMLInputElement> | undefined, newValue: string) => {\n      if (ev && ev.timeStamp === prevChangeTimestamp.current) {\n        // For historical reasons, SearchBox handles both onInput and onChange (we can't modify this\n        // outside a major version due to potential to break partners' tests and possibly apps).\n        // Only call props.onChange for one of the events.\n        return;\n      }\n      prevChangeTimestamp.current = ev?.timeStamp;\n      onChange?.(ev, newValue);\n      onChanged?.(newValue);\n    },\n  );\n  const value = String(uncastValue);\n\n  const rootElementRef = React.useRef<HTMLDivElement>(null);\n  const inputElementRef = React.useRef<HTMLInputElement>(null);\n  const mergedRootRef = useMergedRefs(rootElementRef, forwardedRef);\n  const id = useId(COMPONENT_NAME, props.id);\n\n  const { onClick: customOnClearClick } = clearButtonProps;\n\n  const classNames = getClassNames(styles!, {\n    theme: theme!,\n    className,\n    underlined,\n    hasFocus,\n    disabled,\n    hasInput: value.length > 0,\n    disableAnimation,\n    showIcon,\n  });\n\n  const nativeProps = getNativeProps<React.InputHTMLAttributes<HTMLInputElement>>(props, inputProperties, [\n    'className',\n    'placeholder',\n    'onFocus',\n    'onBlur',\n    'value',\n    'role',\n  ]);\n\n  const onClear = React.useCallback(\n    (ev: React.MouseEvent<HTMLAnchorElement | HTMLButtonElement> | React.KeyboardEvent<HTMLElement>) => {\n      customOnClear?.(ev);\n      if (!ev.defaultPrevented) {\n        setValue('');\n        inputElementRef.current?.focus();\n        ev.stopPropagation();\n        ev.preventDefault();\n      }\n    },\n    [customOnClear, setValue],\n  );\n\n  const onClearClick = React.useCallback(\n    (ev: React.MouseEvent<HTMLAnchorElement | HTMLButtonElement>) => {\n      customOnClearClick?.(ev);\n      if (!ev.defaultPrevented) {\n        onClear(ev);\n      }\n    },\n    [customOnClearClick, onClear],\n  );\n\n  const onFocusCapture = (ev: React.FocusEvent<HTMLElement>) => {\n    setHasFocus(true);\n    props.onFocus?.(ev as React.FocusEvent<HTMLInputElement>);\n  };\n\n  const onClickFocus = () => {\n    if (inputElementRef.current) {\n      inputElementRef.current.focus();\n      inputElementRef.current.selectionStart = inputElementRef.current.selectionEnd = 0;\n    }\n  };\n\n  const onBlur = React.useCallback(\n    (ev: React.FocusEvent<HTMLInputElement>): void => {\n      setHasFocus(false);\n      customOnBlur?.(ev);\n    },\n    [customOnBlur],\n  );\n\n  const onInputChange = (ev: React.ChangeEvent<HTMLInputElement>) => {\n    setValue(ev.target.value, ev);\n  };\n\n  const onKeyDown = (ev: React.KeyboardEvent<HTMLInputElement>) => {\n    // eslint-disable-next-line deprecation/deprecation\n    switch (ev.which) {\n      case KeyCodes.escape:\n        customOnEscape?.(ev);\n        // Only call onClear if the search box has a value to clear. Otherwise, allow the Esc key\n        // to propagate from the empty search box to a parent element such as a dialog, etc.\n        if (value && !ev.defaultPrevented) {\n          onClear(ev);\n        }\n        break;\n\n      case KeyCodes.enter:\n        if (customOnSearch) {\n          customOnSearch(value);\n          ev.preventDefault();\n          ev.stopPropagation();\n        }\n        break;\n\n      default:\n        // REVIEW: Why aren't we calling customOnKeyDown for Escape or Enter?\n        customOnKeyDown?.(ev);\n        // REVIEW: Why are we calling stopPropagation if customOnKeyDown called preventDefault?\n        // customOnKeyDown should call stopPropagation if it needs it.\n        if (ev.defaultPrevented) {\n          ev.stopPropagation();\n        }\n        break;\n    }\n  };\n\n  useDebugWarning(props);\n  useComponentRef(props.componentRef, inputElementRef, hasFocus);\n\n  return (\n    <div role={role} ref={mergedRootRef} className={classNames.root} onFocusCapture={onFocusCapture}>\n      <div className={classNames.iconContainer} onClick={onClickFocus} aria-hidden>\n        <Icon iconName=\"Search\" {...iconProps} className={classNames.icon} />\n      </div>\n      <input\n        {...nativeProps}\n        id={id}\n        className={classNames.field}\n        placeholder={placeholder}\n        onChange={onInputChange}\n        onInput={onInputChange}\n        onBlur={onBlur}\n        onKeyDown={onKeyDown}\n        value={value}\n        disabled={disabled}\n        role=\"searchbox\"\n        aria-label={ariaLabel}\n        ref={inputElementRef}\n      />\n      {value!.length > 0 && (\n        <div className={classNames.clearButton}>\n          <IconButton\n            onBlur={onBlur}\n            styles={iconButtonStyles}\n            iconProps={iconButtonProps}\n            {...clearButtonProps}\n            onClick={onClearClick}\n          />\n        </div>\n      )}\n    </div>\n  );\n});\nSearchBoxBase.displayName = COMPONENT_NAME;\n\nfunction useDebugWarning(props: ISearchBoxProps) {\n  if (process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line react-hooks/rules-of-hooks -- build-time conditional\n    useWarnings({\n      name: COMPONENT_NAME,\n      props,\n      deprecations: { labelText: 'placeholder' },\n    });\n  }\n}\n"]}