{"version":3,"file":"safeSetTimeout.js","sourceRoot":"../src/","sources":["safeSetTimeout.ts"],"names":[],"mappings":";;;AACA,qDAAoD;AAEpD;;;;;GAKG;AACI,IAAM,cAAc,GAAG,UAAC,SAA0B;IACvD,IAAI,cAAiC,CAAC;IAEtC,OAAO,UAAC,EAAY,EAAE,QAAgB;QACpC,IAAI,CAAC,cAAc,EAAE;YACnB,cAAc,GAAG,IAAI,GAAG,EAAgB,CAAC;YAEzC,iCAAe,CAAC,SAAS,EAAE;gBACzB,oBAAoB,EAAE;oBACpB,cAAc,CAAC,OAAO,CAAC,UAAC,EAAgB,IAAK,OAAA,YAAY,CAAC,EAAE,CAAC,EAAhB,CAAgB,CAAC,CAAC;gBACjE,CAAC;aACF,CAAC,CAAC;SACJ;QAED,IAAM,SAAS,GAAG,UAAU,CAAC;YAC3B,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACjC,EAAE,EAAE,CAAC;QACP,CAAC,EAAE,QAAQ,CAAC,CAAC;QACb,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IAChC,CAAC,CAAC;AACJ,CAAC,CAAC;AApBW,QAAA,cAAc,kBAoBzB","sourcesContent":["import * as React from 'react';\nimport { extendComponent } from './extendComponent';\n\n/**\n * Generates a function to be attached to a React component, which can be called\n * as a replacement to setTimeout. In-flight async calls will be auto canceled if the component\n * is unmounting before the async code is executed, preventing bugs where code\n * accesses things within the component after being unmounted.\n */\nexport const safeSetTimeout = (component: React.Component) => {\n  let activeTimeouts: Set<NodeJS.Timer>;\n\n  return (cb: Function, duration: number) => {\n    if (!activeTimeouts) {\n      activeTimeouts = new Set<NodeJS.Timer>();\n\n      extendComponent(component, {\n        componentWillUnmount: () => {\n          activeTimeouts.forEach((id: NodeJS.Timer) => clearTimeout(id));\n        },\n      });\n    }\n\n    const timeoutId = setTimeout(() => {\n      activeTimeouts.delete(timeoutId);\n      cb();\n    }, duration);\n    activeTimeouts.add(timeoutId);\n  };\n};\n"]}